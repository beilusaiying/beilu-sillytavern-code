```
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>开场白选择界面</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');

        :root {
            --theme-bg: #fdf6fa;
            --border-main: #ffccd5;
            --shadow-light: rgba(200, 150, 160, 0.1);
            --shadow-medium: rgba(200, 150, 160, 0.15);

            /* Section Colors */
            --color-char-name: #ffb3d9;
            --color-author: #c7a8ff;
            --color-guide: #a6c9ff;
            --color-notes: #ffd6a5;
            --color-openings: #ff8ba0;
        }

        body {
            margin: 0;
            padding: 20px;
            background-color: var(--theme-bg);
            font-family: 'Noto Sans SC', sans-serif;
            color: #4a4a6a;
        }

        #app {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            border: 2px solid var(--border-main);
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 20px var(--shadow-light);
        }

        .section-card {
            padding: 20px;
            border-radius: 12px;
            border: 1px solid;
            background: #fff;
            box-shadow: 0 2px 10px var(--shadow-light);
            min-width: 200px; /* 最小宽度 */
        }

        .section-card h3 {
            margin: -20px -20px 15px -20px;
            padding: 10px 20px;
            border-radius: 12px 12px 0 0;
            color: #fff;
            font-size: 1.1em;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .section-card .content {
            white-space: pre-wrap;
            line-height: 1.7;
        }

        /* Color theming for each section */
        .char-name-card { border-color: var(--color-char-name); }
        .char-name-card h3 { background-color: var(--color-char-name); }
        .char-name-card .content { font-size: 1.5em; font-weight: 700; color: var(--color-char-name); }

        .author-card { border-color: var(--color-author); }
        .author-card h3 { background-color: var(--color-author); }
        .author-card .content { color: var(--color-author); }

        .guide-card { border-color: var(--color-guide); }
        .guide-card h3 { background-color: var(--color-guide); }

        .notes-card { border-color: var(--color-notes); }
        .notes-card h3 { background-color: var(--color-notes); }

        .openings-card { border-color: var(--color-openings); }
        .openings-card h3 { background-color: var(--color-openings); }

        .opening-item {
            background: #f9f9f9;
            border: 1px solid #eee;
            border-left: 4px solid var(--color-openings);
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .opening-item:last-child {
            margin-bottom: 0;
        }
        .opening-item:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 4px 12px var(--shadow-medium);
            border-color: var(--color-openings);
        }
    </style>
</head>
<body>

<div id="app">
    <!-- 角色卡名 -->
    <div v-if="state.characterName" class="section-card char-name-card">
        <h3>角色卡名</h3>
        <div class="content">{{ state.characterName }}</div>
    </div>

    <!-- 作者 -->
    <div v-if="state.author" class="section-card author-card">
        <h3>作者</h3>
        <div class="content">{{ state.author }}</div>
    </div>

    <!-- 游玩指引 -->
    <div v-if="state.guide" class="section-card guide-card">
        <h3>游玩指引</h3>
        <div class="content" v-html="state.guide"></div>
    </div>

    <!-- 碎碎念 -->
    <div v-if="state.notes" class="section-card notes-card">
        <h3>碎碎念</h3>
        <div class="content" v-html="state.notes"></div>
    </div>

    <!-- 开局介绍和转跳 -->
    <div v-if="state.openings.length" class="section-card openings-card">
        <h3>开局介绍和转跳</h3>
        <div class="content">
            <div v-for="item in state.openings" :key="item.text" class="opening-item" @click="selectOpening(item.swipeIndex)">
                {{ item.text }}
            </div>
        </div>
    </div>
</div>

<script>
const { createApp, reactive, onMounted, ref } = Vue;

const app = createApp({
    setup() {
        // --- Model ---
        const rawKcbTxt = ref(`$1`);
        const state = reactive({
            characterName: '',
            author: '',
            guide: '',
            notes: '',
            openings: []
        });

        // --- Update ---
        // A robust parser inspired by the reference code.
        // It uses regex to extract sections, which is more reliable than line-by-line parsing.
        function parseKcbTxt(rawText) {
            const data = { characterName: '', author: '', guide: '', notes: '', openings: [] };
            if (!rawText || typeof rawText !== 'string') {
                return data;
            }

            const extractSection = (title, text) => {
                // This regex looks for a title (like "作者：") and captures everything until it hits the next title or the end of the string.
                const regex = new RegExp(`${title}[:：]([\\s\\S]*?)(?=(?:角色卡名|作者|游玩指引|碎碎念|开局介绍和转跳)[:：]|$)`);
                const match = text.match(regex);
                return match ? match[1].trim() : '';
            };

            data.characterName = extractSection('角色卡名', rawText);
            data.author = extractSection('作者', rawText);
            data.guide = extractSection('游玩指引', rawText);
            data.notes = extractSection('碎碎念', rawText);

            const openingsText = extractSection('开局介绍和转跳', rawText);
            if (openingsText) {
                data.openings = openingsText.split(/\r?\n/)
                    .map(line => line.trim())
                    .filter(line => line)
                    .map((line, index) => {
                        // Check for "Display Text == /swipe N" format
                        const match = line.match(/(.*)==\s*\/swipe\s*(\d+)/);
                        if (match) {
                            // Explicit swipe: User provides 1-based index, API needs 0-based.
                            return { text: match[1].trim(), swipeIndex: parseInt(match[2], 10) - 1 };
                        } else {
                            // Implicit swipe: The first option (index 0) should map to the second swipe (index 1).
                            return { text: line, swipeIndex: index + 1 };
                        }
                    });
            }

            return data;
        }

        // This function switches the AI response swipe, adapted from the reference file.
        const switchSwipe = async (index) => {
            try {
                // Access SillyTavern's global state
                const chat = SillyTavern.chat[0];
                if (chat && chat.swipes && chat.swipes.length > index) {
                    chat.swipe_id = index;
                    chat.mes = chat.swipes[index];
                    await SillyTavern.saveChat();
                    await SillyTavern.reloadCurrentChat();
                } else {
                    console.warn(`Swipe index ${index} is out of bounds.`);
                }
            } catch (e) {
                console.error("Error switching swipe:", e);
                alert(`切换滑动页时出错: ${e.message}`);
            }
        };

        const selectOpening = (index) => {
            // Now calls switchSwipe with the index of the clicked item.
            switchSwipe(index);
        };

        // --- Lifecycle ---
        onMounted(() => {
            const parsedData = parseKcbTxt(rawKcbTxt.value);
            Object.assign(state, parsedData);
        });

        return {
            state,
            selectOpening,
        };
    }
});

app.mount('#app');
</script>

</body>
</html>
```
